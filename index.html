<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>舞岩抱石攀岩館 責任風險承擔同意書</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 2em;
      max-width: 600px;
      background: #f8f8f8;
    }
    label {
      display: block;
      margin-top: 1em;
    }
    input, button, canvas {
      font-size: 1em;
    }
    input, button {
      padding: 0.5em;
      border-radius: 5px;
      border: 1px solid #bbb;
      margin-top: 0.2em;
    }
    input:focus {
      outline: 2px solid #89c;
      border: 1px solid #666;
    }
    form {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 16px #0001;
      padding: 1.2em;
    }
    canvas {
      border: 1px solid #ccc;
      width: 100%;
      height: 180px;
      border-radius: 8px;
      background: #fff;
      touch-action: none;
    }
    .btn-row {
      display: flex;
      gap: 1em;
      margin-top: 1em;
      flex-wrap: wrap;
    }
    button {
      background: #3572b7;
      color: #fff;
      border: none;
      cursor: pointer;
      min-width: 100px;
      font-weight: bold;
      transition: background 0.2s;
    }
    button:hover {
      background: #245388;
    }
    @media (max-width: 600px) {
      body {
        margin: 0.5em;
      }
      form {
        padding: 0.6em;
      }
      h2 {
        font-size: 1.2em;
      }
      canvas {
        height: 110px;
      }
    }
  </style>
</head>
<body>
  <h2>舞岩抱石攀岩館 責任風險承擔同意書</h2>

  <form id="waiverForm" autocomplete="off">
    <label>姓名：<input type="text" name="name" required></label>
    <label>出生年月日：<input type="date" name="dob" required></label>
    <label>手機號碼：<input type="tel" name="phone" required></label>
    <label>緊急聯絡人：<input type="text" name="emergency_contact" required></label>
    <label>緊急聯絡人電話：<input type="tel" name="emergency_phone" required></label>

    <label>同意條款：</label>
    <p style="background:#f1f3f6;padding:0.7em;border-radius:7px;font-size:0.96em;line-height:1.7;">
      本人了解攀岩活動具有潛在之風險，包含但不限於跌落、撞擊、擦傷或其他不可預期之受傷情況。
      本人保證已詳閱場館之使用規則，並願意配戴必要之安全裝備，遵守場館人員指示。
      本人確認，若因個人行為、身體狀況不佳或未遵守場館規定而導致任何傷害、事故或損失，願自行承擔全部責任，並免除舞岩抱石攀岩館與其工作人員之任何賠償義務。如參與者為未滿十八歲之未成年人，本人為其家長／監護人，並同意其參與本活動，同時承擔上述責任。
    </p>

    <label>簽名：</label>
    <canvas id="signature-pad"></canvas>

    <div class="btn-row">
      <button type="button" id="clear-signature" style="background:#888;">清除簽名</button>
      <button type="submit">送出</button>
    </div>
  </form>

  <p id="success-msg" style="color: green; display: none; margin-top:1em;">✅ 已成功送出！</p>

  <script>
    const canvas = document.getElementById('signature-pad');
    const signaturePad = new SignaturePad(canvas, { minWidth:1.5, maxWidth:3 });
    const clearBtn = document.getElementById('clear-signature');
    clearBtn.addEventListener('click', () => signaturePad.clear());

    // 自動調整簽名區寬度
    function resizeCanvas() {
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      canvas.width = canvas.offsetWidth * ratio;
      canvas.height = canvas.offsetHeight * ratio;
      canvas.getContext('2d').scale(ratio, ratio);
      signaturePad.clear();
    }
    window.addEventListener('resize', resizeCanvas);
    setTimeout(resizeCanvas, 200);

    document.getElementById('waiverForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      if (signaturePad.isEmpty()) {
        alert('請簽名後再送出');
        return;
      }

      const formData = new FormData(this);
      formData.append('signature', signaturePad.toDataURL());

      const scriptURL = 'https://script.google.com/macros/s/AKfycbzxuEDWvZR8JwU339srh8gmocwIIw85i5a4vItGR6ijHEQ5_9mdU7KssTg6NMY8Q6-Hjg/exec';

      try {
        const response = await fetch(scriptURL, {
          method: 'POST',
          body: formData
        });

        if (response.ok) {
          document.getElementById('success-msg').style.display = 'block';
          this.reset();
          signaturePad.clear();
        } else {
          alert('送出失敗，請確認網路連線或稍後再試');
        }
      } catch (error) {
        console.error('送出錯誤:', error);
        alert('送出過程中發生錯誤');
      }
    });
  </script>
</body>
</html>
